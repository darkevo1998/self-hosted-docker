upstream activepieces_backend {
    server activepieces:80;
    keepalive 32;
}

# Telugu domain - తెలుగు.net
server {
    listen 0.0.0.0:80;
    listen [::]:80;
    server_name తెలుగు.net www.తెలుగు.net;

    # Uncomment for HTTPS
    # listen 443 ssl http2;
    # ssl_certificate /etc/nginx/certs/telugu-fullchain.pem;
    # ssl_certificate_key /etc/nginx/certs/telugu-privkey.pem;

    client_max_body_size 50m;

    location / {
        proxy_pass http://activepieces_backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Default-Language te;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        proxy_read_timeout 300s;

        # Disable gzip for sub_filter to work properly
        proxy_set_header Accept-Encoding "";

        # Inject Google Translate widget for Telugu
        sub_filter '</head>' '<div id="google_translate_element" style="position: fixed; top: 0; right: 0; z-index: 9999; background: white; padding: 5px; border: 1px solid #ccc; border-radius: 4px;"></div><script type="text/javascript">function googleTranslateElementInit() { new google.translate.TranslateElement({pageLanguage: \'te\', includedLanguages: \'te,hi,ta,en\', layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, \'google_translate_element\'); }</script><script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script></head>';
        sub_filter_once on;
        sub_filter_types text/html;
    }

    location = /healthz {
        access_log off;
        return 200 'ok';
    }
}

# Hindi domain - हिंदी.net
server {
    listen 0.0.0.0:80;
    listen [::]:80;
    server_name हिंदी.net www.हिंदी.net;

    # Uncomment for HTTPS
    # listen 443 ssl http2;
    # ssl_certificate /etc/nginx/certs/hindi-fullchain.pem;
    # ssl_certificate_key /etc/nginx/certs/hindi-privkey.pem;

    client_max_body_size 50m;

    location / {
        proxy_pass http://activepieces_backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Default-Language hi;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        proxy_read_timeout 300s;

        # Disable gzip for sub_filter to work properly
        proxy_set_header Accept-Encoding "";

        # Inject Google Translate widget for Hindi
        sub_filter '</head>' '<div id="google_translate_element" style="position: fixed; top: 0; right: 0; z-index: 9999; background: white; padding: 5px; border: 1px solid #ccc; border-radius: 4px;"></div><script type="text/javascript">function googleTranslateElementInit() { new google.translate.TranslateElement({pageLanguage: \'hi\', includedLanguages: \'hi,te,ta,en\', layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, \'google_translate_element\'); }</script><script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script></head>';
        sub_filter_once on;
        sub_filter_types text/html;
    }

    location = /healthz {
        access_log off;
        return 200 'ok';
    }
}

# Tamil domain - தமிழ்மொழி.com
server {
    listen 0.0.0.0:80;
    listen [::]:80;
    server_name தமிழ்மொழி.com www.தமிழ்மொழி.com;

    # Uncomment for HTTPS
    # listen 443 ssl http2;
    # ssl_certificate /etc/nginx/certs/tamil-fullchain.pem;
    # ssl_certificate_key /etc/nginx/certs/tamil-privkey.pem;

    client_max_body_size 50m;

    location / {
        proxy_pass http://activepieces_backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Default-Language ta;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        proxy_read_timeout 300s;

        # Disable gzip for sub_filter to work properly
        proxy_set_header Accept-Encoding "";

        # Inject Google Translate widget for Tamil
        sub_filter '</head>' '<div id="google_translate_element" style="position: fixed; top: 0; right: 0; z-index: 9999; background: white; padding: 5px; border: 1px solid #ccc; border-radius: 4px;"></div><script type="text/javascript">function googleTranslateElementInit() { new google.translate.TranslateElement({pageLanguage: \'ta\', includedLanguages: \'ta,hi,te,en\', layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, \'google_translate_element\'); }</script><script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script></head>';
        sub_filter_once on;
        sub_filter_types text/html;
    }

    location = /healthz {
        access_log off;
        return 200 'ok';
    }
}

# English domain - talktocomputer.com (no translation widget)
server {
    listen 0.0.0.0:80;
    listen [::]:80;
    server_name talktocomputer.com www.talktocomputer.com;

    # Uncomment for HTTPS
    # listen 443 ssl http2;
    # ssl_certificate /etc/nginx/certs/english-fullchain.pem;
    # ssl_certificate_key /etc/nginx/certs/english-privkey.pem;

    client_max_body_size 50m;

    location / {
        proxy_pass http://activepieces_backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Default-Language en;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        proxy_read_timeout 300s;
    }

    location = /healthz {
        access_log off;
        return 200 'ok';
    }
}

# Default server (fallback)
server {
    listen 0.0.0.0:80 default_server;
    listen [::]:80 default_server;
    server_name _;

    # Uncomment for HTTPS
    # listen 443 ssl http2 default_server;
    # ssl_certificate /etc/nginx/certs/fullchain.pem;
    # ssl_certificate_key /etc/nginx/certs/privkey.pem;

    client_max_body_size 50m;

    location / {
        proxy_pass http://activepieces_backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        proxy_read_timeout 300s;
    }

    location = /healthz {
        access_log off;
        return 200 'ok';
    }
}
