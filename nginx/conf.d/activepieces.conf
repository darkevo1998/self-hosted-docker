upstream activepieces_backend {
    server activepieces:80;
    keepalive 32;
}

# Telugu domain - తెలుగు.net
server {
    listen 0.0.0.0:80;
    listen [::]:80;
    server_name తెలుగు.net www.తెలుగు.net;

    # Uncomment for HTTPS
    # listen 443 ssl http2;
    # ssl_certificate /etc/nginx/certs/telugu-fullchain.pem;
    # ssl_certificate_key /etc/nginx/certs/telugu-privkey.pem;

    client_max_body_size 50m;

    location / {
        proxy_pass http://activepieces_backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Default-Language te;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        proxy_read_timeout 300s;

        # Disable gzip for sub_filter to work properly
        proxy_set_header Accept-Encoding "";

        # Inject Google Translate widget for Telugu with custom positioning - FORCED BOTTOM LEFT
        sub_filter '</head>' '<style>div:has(#google_translate_element){position:fixed!important;bottom:100px!important;left:10px!important;top:auto!important;right:auto!important;z-index:99999!important;transform:translate(0,0)!important}*[class*="goog-te"],.goog-te-gadget,.skiptranslate,#google_translate_element{position:static!important;bottom:auto!important;left:auto!important;top:auto!important;right:auto!important;transform:none!important;margin:0!important;float:none!important}.skiptranslate{display:block!important}</style><div id="google_translate_element"></div><script>(function(){function forcePosition(){var gt=document.getElementById("google_translate_element");if(gt){var parent=gt.parentElement;if(parent&&parent!==document.body){var style=parent.style;style.setProperty("position","fixed","important");style.setProperty("bottom","100px","important");style.setProperty("left","10px","important");style.setProperty("top","auto","important");style.setProperty("right","auto","important");style.setProperty("z-index","99999","important");style.removeProperty("transform");style.setProperty("transform","translate(0,0)","important")}gt.style.cssText="position:static!important;bottom:auto!important;left:auto!important;top:auto!important;right:auto!important;transform:none!important;margin:0!important;display:block!important";var gadgets=document.querySelectorAll(".goog-te-gadget,.skiptranslate");gadgets.forEach(function(e){e.style.cssText="position:static!important;bottom:auto!important;left:auto!important;top:auto!important;right:auto!important;transform:none!important;margin:0!important;display:block!important"})}}function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"te",includedLanguages:"te,hi,ta,en"},"google_translate_element");forcePosition();var m=new MutationObserver(forcePosition);m.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]});setInterval(forcePosition,5);[5,10,50,100,200,500,1000,2000,3000,5000].forEach(function(t){setTimeout(forcePosition,t)})}window.googleTranslateElementInit=googleTranslateElementInit;setInterval(forcePosition,5)})()</script><script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script></head>';
        sub_filter_once on;
        sub_filter_types text/html;
    }

    location = /healthz {
        access_log off;
        return 200 'ok';
    }
}

# Hindi domain - हिंदी.net
server {
    listen 0.0.0.0:80;
    listen [::]:80;
    server_name हिंदी.net www.हिंदी.net;

    # Uncomment for HTTPS
    # listen 443 ssl http2;
    # ssl_certificate /etc/nginx/certs/hindi-fullchain.pem;
    # ssl_certificate_key /etc/nginx/certs/hindi-privkey.pem;

    client_max_body_size 50m;

    location / {
        proxy_pass http://activepieces_backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Default-Language hi;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        proxy_read_timeout 300s;

        # Disable gzip for sub_filter to work properly
        proxy_set_header Accept-Encoding "";

        # Inject Google Translate widget for Hindi with custom positioning - FORCED BOTTOM LEFT
        sub_filter '</head>' '<style>div:has(#google_translate_element){position:fixed!important;bottom:100px!important;left:10px!important;top:auto!important;right:auto!important;z-index:99999!important;transform:translate(0,0)!important}*[class*="goog-te"],.goog-te-gadget,.skiptranslate,#google_translate_element{position:static!important;bottom:auto!important;left:auto!important;top:auto!important;right:auto!important;transform:none!important;margin:0!important;float:none!important}.skiptranslate{display:block!important}</style><div id="google_translate_element"></div><script>(function(){function forcePosition(){var gt=document.getElementById("google_translate_element");if(gt){var parent=gt.parentElement;if(parent&&parent!==document.body){var style=parent.style;style.setProperty("position","fixed","important");style.setProperty("bottom","100px","important");style.setProperty("left","10px","important");style.setProperty("top","auto","important");style.setProperty("right","auto","important");style.setProperty("z-index","99999","important");style.removeProperty("transform");style.setProperty("transform","translate(0,0)","important")}gt.style.cssText="position:static!important;bottom:auto!important;left:auto!important;top:auto!important;right:auto!important;transform:none!important;margin:0!important;display:block!important";var gadgets=document.querySelectorAll(".goog-te-gadget,.skiptranslate");gadgets.forEach(function(e){e.style.cssText="position:static!important;bottom:auto!important;left:auto!important;top:auto!important;right:auto!important;transform:none!important;margin:0!important;display:block!important"})}}function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"hi",includedLanguages:"hi,te,ta,en"},"google_translate_element");forcePosition();var m=new MutationObserver(forcePosition);m.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]});setInterval(forcePosition,5);[5,10,50,100,200,500,1000,2000,3000,5000].forEach(function(t){setTimeout(forcePosition,t)})}window.googleTranslateElementInit=googleTranslateElementInit;setInterval(forcePosition,5)})()</script><script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script></head>';
        sub_filter_once on;
        sub_filter_types text/html;
    }

    location = /healthz {
        access_log off;
        return 200 'ok';
    }
}

# Tamil domain - தமிழ்மொழி.com
server {
    listen 0.0.0.0:80;
    listen [::]:80;
    server_name தமிழ்மொழி.com www.தமிழ்மொழி.com;

    # Uncomment for HTTPS
    # listen 443 ssl http2;
    # ssl_certificate /etc/nginx/certs/tamil-fullchain.pem;
    # ssl_certificate_key /etc/nginx/certs/tamil-privkey.pem;

    client_max_body_size 50m;

    location / {
        proxy_pass http://activepieces_backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Default-Language ta;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        proxy_read_timeout 300s;

        # Disable gzip for sub_filter to work properly
        proxy_set_header Accept-Encoding "";

        # Inject Google Translate widget for Tamil with custom positioning - FORCED BOTTOM LEFT
        sub_filter '</head>' '<style>div:has(#google_translate_element){position:fixed!important;bottom:100px!important;left:10px!important;top:auto!important;right:auto!important;z-index:99999!important;transform:translate(0,0)!important}*[class*="goog-te"],.goog-te-gadget,.skiptranslate,#google_translate_element{position:static!important;bottom:auto!important;left:auto!important;top:auto!important;right:auto!important;transform:none!important;margin:0!important;float:none!important}.skiptranslate{display:block!important}</style><div id="google_translate_element"></div><script>(function(){function forcePosition(){var gt=document.getElementById("google_translate_element");if(gt){var parent=gt.parentElement;if(parent&&parent!==document.body){var style=parent.style;style.setProperty("position","fixed","important");style.setProperty("bottom","100px","important");style.setProperty("left","10px","important");style.setProperty("top","auto","important");style.setProperty("right","auto","important");style.setProperty("z-index","99999","important");style.removeProperty("transform");style.setProperty("transform","translate(0,0)","important")}gt.style.cssText="position:static!important;bottom:auto!important;left:auto!important;top:auto!important;right:auto!important;transform:none!important;margin:0!important;display:block!important";var gadgets=document.querySelectorAll(".goog-te-gadget,.skiptranslate");gadgets.forEach(function(e){e.style.cssText="position:static!important;bottom:auto!important;left:auto!important;top:auto!important;right:auto!important;transform:none!important;margin:0!important;display:block!important"})}}function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"ta",includedLanguages:"ta,hi,te,en"},"google_translate_element");forcePosition();var m=new MutationObserver(forcePosition);m.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]});setInterval(forcePosition,5);[5,10,50,100,200,500,1000,2000,3000,5000].forEach(function(t){setTimeout(forcePosition,t)})}window.googleTranslateElementInit=googleTranslateElementInit;setInterval(forcePosition,5)})()</script><script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script></head>';
        sub_filter_once on;
        sub_filter_types text/html;
    }

    location = /healthz {
        access_log off;
        return 200 'ok';
    }
}

# English domain - talktocomputer.com (no translation widget)
server {
    listen 0.0.0.0:80;
    listen [::]:80;
    server_name talktocomputer.com www.talktocomputer.com;

    # Uncomment for HTTPS
    # listen 443 ssl http2;
    # ssl_certificate /etc/nginx/certs/english-fullchain.pem;
    # ssl_certificate_key /etc/nginx/certs/english-privkey.pem;

    client_max_body_size 50m;

    location / {
        proxy_pass http://activepieces_backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Default-Language en;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        proxy_read_timeout 300s;
    }

    location = /healthz {
        access_log off;
        return 200 'ok';
    }
}

# Default server (fallback)
server {
    listen 0.0.0.0:80 default_server;
    listen [::]:80 default_server;
    server_name _;

    # Uncomment for HTTPS
    # listen 443 ssl http2 default_server;
    # ssl_certificate /etc/nginx/certs/fullchain.pem;
    # ssl_certificate_key /etc/nginx/certs/privkey.pem;

    client_max_body_size 50m;

    location / {
        proxy_pass http://activepieces_backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        proxy_read_timeout 300s;
    }

    location = /healthz {
        access_log off;
        return 200 'ok';
    }
}
